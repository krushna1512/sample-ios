lane :build_only do
  api_key = app_store_connect_api_key(
    key_id: ENV["APP_STORE_CONNECT_API_KEY_KEY_ID"],
    issuer_id: ENV["APP_STORE_CONNECT_API_KEY_ISSUER_ID"],
    key_filepath: File.expand_path("~/private_keys/AuthKey_#{ENV["APP_STORE_CONNECT_API_KEY_KEY_ID"]}.p8")
  )

  match(
    api_key: api_key,
    git_url: ENV["MATCH_GIT_URL"],
    git_branch: ENV["MATCH_GIT_BRANCH"] || "certs",
    type: "development",
    app_identifier: "com.yapsody.SampleApp",
    readonly: true,
    verbose: true
  )

  build_app(
    scheme: "SampleApp",
    export_method: "development",
    project: "SampleApp.xcodeproj",
    export_team_id: "MWVFW922NX",
    export_options: {
      provisioningProfiles: {
        "com.yapsody.SampleApp" => "match Development com.yapsody.SampleApp"
      },
      signingStyle: "manual",
      signingCertificate: "Apple Development",
      teamID: "MWVFW922NX"
    },
    xcargs: "-allowProvisioningUpdates"
  )
end
